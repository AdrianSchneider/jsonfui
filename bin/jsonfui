#!/usr/bin/env node
'use strict';

var fs       = require('fs');
var path     = require('path');
var program  = require('commander');
var app      = require('../src/app');
var config   = require('../package.json');

program
  .version(config.version)
  .usage('<filename>')
  .parse(process.argv);

if(!program.args[0]) {
  program.outputHelp();
  process.exit(1);
}

fs.readFile(path.resolve(process.cwd(), program.args[0]), function(err, content) {
  var json = content.toString('utf-8');

  try {
    var data = JSON.parse(json);
  } catch (e) { }

  if(!data) {
    console.error('Input is not valid JSON');
    process.exit(1);
  }

  if(data === null || typeof data === 'string' || typeof data === 'number' || typeof data === 'boolean') {
    console.log(data);
    process.exit(0);
  }

  if(Array.isArray(data) && !data.length) {
    console.log('[] (empty array)');
    process.exit(0);
  }

  if(!Array.isArray(data) && !Object.keys(data).length) {
    console.log('{} (empty object)');
    process.exit(0);
  }

  app(data);
});
